/*!
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.dev/license
 */
import { WebContainer, } from '@webcontainer/api';
export class FakeEventTarget {
    constructor() {
        this.listeners = new Map();
    }
    addEventListener(type, listener) {
        const listeners = this.listeners.get(type) || [];
        listeners.push(listener);
        this.listeners.set(type, listeners);
    }
    removeEventListener(type, listener) {
        const listeners = this.listeners.get(type);
        if (listeners) {
            const index = listeners.indexOf(listener);
            if (index !== -1) {
                listeners.splice(index, 1);
            }
        }
    }
    dispatchEvent(event) {
        const listeners = this.listeners.get(event.type);
        if (listeners) {
            for (const listener of listeners) {
                if (typeof listener === 'function') {
                    listener.call(this, event);
                }
                else {
                    listener.handleEvent(event);
                }
            }
        }
        return true;
    }
}
export class MockLocalStorage {
    constructor() {
        this.items = new Map();
    }
    getItem(key) {
        return this.items.get(key) ?? null;
    }
    setItem(key, value) {
        this.items.set(key, value);
    }
}
export class FakeChangeDetectorRef {
    markForCheck() { }
    detach() { }
    checkNoChanges() { }
    reattach() { }
    detectChanges() { }
}
export class FakeWebContainer extends WebContainer {
    constructor(fakeOptions) {
        super();
        this.fakeSpawn = undefined;
        this.fs = new FakeFileSystemAPI();
        if (fakeOptions?.spawn)
            this.fakeSpawn = fakeOptions.spawn;
    }
    spawn(command, args, options) {
        if (this.fakeSpawn)
            return Promise.resolve(this.fakeSpawn);
        const fakeProcess = new FakeWebContainerProcess();
        return Promise.resolve(fakeProcess);
    }
    on(event, listener) {
        return () => { };
    }
    mount(tree, options) {
        return Promise.resolve();
    }
    get path() {
        return '/fake-path';
    }
    get workdir() {
        return '/fake-workdir';
    }
    teardown() { }
}
class FakeFileSystemAPI {
    readdir(path, options) {
        return Promise.resolve(['/fake-dirname']);
    }
    readFile(path, encoding) {
        return Promise.resolve('fake file content');
    }
    writeFile(path, data, options) {
        return Promise.resolve();
    }
    mkdir(path, options) {
        return Promise.resolve();
    }
    rm(path, options) {
        return Promise.resolve();
    }
    rename(oldPath, newPath) {
        throw Error('Not implemented');
    }
    watch(filename, options, listener) {
        throw Error('Not implemented');
    }
}
export class FakeWebContainerProcess {
    constructor() {
        this.exit = Promise.resolve(0);
        this.input = new WritableStream();
        this.output = new ReadableStream();
    }
    kill() { }
    resize(dimensions) { }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdGluZy1oZWxwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9kb2NzL3Rlc3RpbmcvdGVzdGluZy1oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBR0gsT0FBTyxFQVdMLFlBQVksR0FFYixNQUFNLG1CQUFtQixDQUFDO0FBRTNCLE1BQU0sT0FBTyxlQUFlO0lBQTVCO1FBQ0UsY0FBUyxHQUFzRCxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBK0IzRSxDQUFDO0lBN0JDLGdCQUFnQixDQUFDLElBQVksRUFBRSxRQUE0QztRQUN6RSxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakQsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELG1CQUFtQixDQUFDLElBQVksRUFBRSxRQUE0QztRQUM1RSxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLFNBQVMsRUFBRSxDQUFDO1lBQ2QsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMxQyxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNqQixTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3QixDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxhQUFhLENBQUMsS0FBWTtRQUN4QixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQs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QUUsQ0FDQSxJQUFZLEVBQ1osT0FBb0Y7UUFFcEYsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVELE1BQU0sQ0FBQyxPQUFlLEVBQUUsT0FBZTtRQUNyQyxNQUFNLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFPRCxLQUFLLENBQUMsUUFBaUIsRUFBRSxPQUFpQixFQUFFLFFBQWtCO1FBQzVELE1BQU0sS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDakMsQ0FBQztDQUNGO0FBRUQsTUFBTSxPQUFPLHVCQUF1QjtJQUFwQztRQUNFLFNBQUksR0FBb0IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQyxVQUFLLEdBQTJCLElBQUksY0FBYyxFQUFVLENBQUM7UUFDN0QsV0FBTSxHQUEyQixJQUFJLGNBQWMsRUFBVSxDQUFDO0lBSWhFLENBQUM7SUFGQyxJQUFJLEtBQVUsQ0FBQztJQUNmLE1BQU0sQ0FBQyxVQUF3QyxJQUFTLENBQUM7Q0FDMUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5kZXYvbGljZW5zZVxuICovXG5cbmltcG9ydCB7Q2hhbmdlRGV0ZWN0b3JSZWZ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgRGlyRW50LFxuICBFcnJvckxpc3RlbmVyLFxuICBGU1dhdGNoQ2FsbGJhY2ssXG4gIEZTV2F0Y2hPcHRpb25zLFxuICBGaWxlU3lzdGVtQVBJLFxuICBGaWxlU3lzdGVtVHJlZSxcbiAgSUZTV2F0Y2hlcixcbiAgUG9ydExpc3RlbmVyLFxuICBTZXJ2ZXJSZWFkeUxpc3RlbmVyLFxuICBVbnN1YnNjcmliZSxcbiAgV2ViQ29udGFpbmVyLFxuICBXZWJDb250YWluZXJQcm9jZXNzLFxufSBmcm9tICdAd2ViY29udGFpbmVyL2FwaSc7XG5cbmV4cG9ydCBjbGFzcyBGYWtlRXZlbnRUYXJnZXQgaW1wbGVtZW50cyBFdmVudFRhcmdldCB7XG4gIGxpc3RlbmVyczogTWFwPHN0cmluZywgRXZlbnRMaXN0ZW5lck9yRXZlbnRMaXN0ZW5lck9iamVjdFtdPiA9IG5ldyBNYXAoKTtcblxuICBhZGRFdmVudExpc3RlbmVyKHR5cGU6IHN0cmluZywgbGlzdGVuZXI6IEV2ZW50TGlzdGVuZXJPckV2ZW50TGlzdGVuZXJPYmplY3QpOiB2b2lkIHtcbiAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQodHlwZSkgfHwgW107XG4gICAgbGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpO1xuICAgIHRoaXMubGlzdGVuZXJzLnNldCh0eXBlLCBsaXN0ZW5lcnMpO1xuICB9XG5cbiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlOiBzdHJpbmcsIGxpc3RlbmVyOiBFdmVudExpc3RlbmVyT3JFdmVudExpc3RlbmVyT2JqZWN0KTogdm9pZCB7XG4gICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMuZ2V0KHR5cGUpO1xuICAgIGlmIChsaXN0ZW5lcnMpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpO1xuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICBsaXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBkaXNwYXRjaEV2ZW50KGV2ZW50OiBFdmVudCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzLmdldChldmVudC50eXBlKTtcbiAgICBpZiAobGlzdGVuZXJzKSB7XG4gICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIGxpc3RlbmVycykge1xuICAgICAgICBpZiAodHlwZW9mIGxpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgbGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGlzdGVuZXIuaGFuZGxlRXZlbnQoZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBNb2NrTG9jYWxTdG9yYWdlIGltcGxlbWVudHMgUGljazxTdG9yYWdlLCAnZ2V0SXRlbScgfCAnc2V0SXRlbSc+IHtcbiAgcHJpdmF0ZSBpdGVtcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmcgfCBudWxsPigpO1xuXG4gIGdldEl0ZW0oa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtcy5nZXQoa2V5KSA/PyBudWxsO1xuICB9XG5cbiAgc2V0SXRlbShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IG51bGwpOiB2b2lkIHtcbiAgICB0aGlzLml0ZW1zLnNldChrZXksIHZhbHVlKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRmFrZUNoYW5nZURldGVjdG9yUmVmIGltcGxlbWVudHMgQ2hhbmdlRGV0ZWN0b3JSZWYge1xuICBtYXJrRm9yQ2hlY2soKTogdm9pZCB7fVxuICBkZXRhY2goKTogdm9pZCB7fVxuICBjaGVja05vQ2hhbmdlcygpOiB2b2lkIHt9XG4gIHJlYXR0YWNoKCk6IHZvaWQge31cbiAgZGV0ZWN0Q2hhbmdlcygpOiB2b2lkIHt9XG59XG5cbmV4cG9ydCBjbGFzcyBGYWtlV2ViQ29udGFpbmVyIGV4dGVuZHMgV2ViQ29udGFpbmVyIHtcbiAgZmFrZVNwYXduOiBGYWtlV2ViQ29udGFpbmVyUHJvY2VzcyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihmYWtlT3B0aW9ucz86IHtzcGF3bjogRmFrZVdlYkNvbnRhaW5lclByb2Nlc3N9KSB7XG4gICAgc3VwZXIoKTtcbiAgICBpZiAoZmFrZU9wdGlvbnM/LnNwYXduKSB0aGlzLmZha2VTcGF3biA9IGZha2VPcHRpb25zLnNwYXduO1xuICB9XG5cbiAgb3ZlcnJpZGUgc3Bhd24oXG4gICAgY29tbWFuZDogdW5rbm93bixcbiAgICBhcmdzPzogdW5rbm93bixcbiAgICBvcHRpb25zPzogdW5rbm93bixcbiAgKTogUHJvbWlzZTxGYWtlV2ViQ29udGFpbmVyUHJvY2Vzcz4ge1xuICAgIGlmICh0aGlzLmZha2VTcGF3bikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmZha2VTcGF3bik7XG5cbiAgICBjb25zdCBmYWtlUHJvY2VzcyA9IG5ldyBGYWtlV2ViQ29udGFpbmVyUHJvY2VzcygpO1xuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWtlUHJvY2Vzcyk7XG4gIH1cbiAgb3ZlcnJpZGUgb24oZXZlbnQ6ICdwb3J0JywgbGlzdGVuZXI6IFBvcnRMaXN0ZW5lcik6IFVuc3Vic2NyaWJlO1xuICBvdmVycmlkZSBvbihldmVudDogJ3NlcnZlci1yZWFkeScsIGxpc3RlbmVyOiBTZXJ2ZXJSZWFkeUxpc3RlbmVyKTogVW5zdWJzY3JpYmU7XG4gIG92ZXJyaWRlIG9uKGV2ZW50OiAnZXJyb3InLCBsaXN0ZW5lcjogRXJyb3JMaXN0ZW5lcik6IFVuc3Vic2NyaWJlO1xuICBvdmVycmlkZSBvbihldmVudDogdW5rbm93biwgbGlzdGVuZXI6IHVua25vd24pOiBVbnN1YnNjcmliZSB7XG4gICAgcmV0dXJuICgpID0+IHt9O1xuICB9XG4gIG92ZXJyaWRlIG1vdW50KFxuICAgIHRyZWU6IEZpbGVTeXN0ZW1UcmVlLFxuICAgIG9wdGlvbnM/OiB7bW91bnRQb2ludD86IHN0cmluZyB8IHVuZGVmaW5lZH0gfCB1bmRlZmluZWQsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuICBvdmVycmlkZSBnZXQgcGF0aCgpIHtcbiAgICByZXR1cm4gJy9mYWtlLXBhdGgnO1xuICB9XG4gIG92ZXJyaWRlIGdldCB3b3JrZGlyKCkge1xuICAgIHJldHVybiAnL2Zha2Utd29ya2Rpcic7XG4gIH1cblxuICBvdmVycmlkZSB0ZWFyZG93bigpIHt9XG5cbiAgb3ZlcnJpZGUgZnM6IEZha2VGaWxlU3lzdGVtQVBJID0gbmV3IEZha2VGaWxlU3lzdGVtQVBJKCk7XG59XG5cbmNsYXNzIEZha2VGaWxlU3lzdGVtQVBJIGltcGxlbWVudHMgRmlsZVN5c3RlbUFQSSB7XG4gIHJlYWRkaXIoXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIG9wdGlvbnM6ICdidWZmZXInIHwge2VuY29kaW5nOiAnYnVmZmVyJzsgd2l0aEZpbGVUeXBlcz86IGZhbHNlIHwgdW5kZWZpbmVkfSxcbiAgKTogUHJvbWlzZTxVaW50OEFycmF5W10+O1xuICByZWFkZGlyKFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBvcHRpb25zPzpcbiAgICAgIHwgc3RyaW5nXG4gICAgICB8IHtlbmNvZGluZz86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7IHdpdGhGaWxlVHlwZXM/OiBmYWxzZSB8IHVuZGVmaW5lZH1cbiAgICAgIHwgbnVsbFxuICAgICAgfCB1bmRlZmluZWQsXG4gICk6IFByb21pc2U8c3RyaW5nW10+O1xuICByZWFkZGlyKFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7ZW5jb2Rpbmc6ICdidWZmZXInOyB3aXRoRmlsZVR5cGVzOiB0cnVlfSxcbiAgKTogUHJvbWlzZTxEaXJFbnQ8VWludDhBcnJheT5bXT47XG4gIHJlYWRkaXIoXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtlbmNvZGluZz86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7IHdpdGhGaWxlVHlwZXM6IHRydWV9LFxuICApOiBQcm9taXNlPERpckVudDxzdHJpbmc+W10+O1xuICByZWFkZGlyKFxuICAgIHBhdGg6IHVua25vd24sXG4gICAgb3B0aW9ucz86IHVua25vd24sXG4gICk6XG4gICAgfCBQcm9taXNlPFVpbnQ4QXJyYXlbXT5cbiAgICB8IFByb21pc2U8c3RyaW5nW10+XG4gICAgfCBQcm9taXNlPERpckVudDxVaW50OEFycmF5PltdPlxuICAgIHwgUHJvbWlzZTxEaXJFbnQ8c3RyaW5nPltdPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbJy9mYWtlLWRpcm5hbWUnXSk7XG4gIH1cblxuICByZWFkRmlsZShwYXRoOiBzdHJpbmcsIGVuY29kaW5nPzogbnVsbCB8IHVuZGVmaW5lZCk6IFByb21pc2U8VWludDhBcnJheT47XG4gIHJlYWRGaWxlKHBhdGg6IHN0cmluZywgZW5jb2Rpbmc6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPjtcbiAgcmVhZEZpbGUocGF0aDogdW5rbm93biwgZW5jb2Rpbmc/OiB1bmtub3duKTogUHJvbWlzZTxVaW50OEFycmF5PiB8IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgnZmFrZSBmaWxlIGNvbnRlbnQnKTtcbiAgfVxuICB3cml0ZUZpbGUoXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIGRhdGE6IHN0cmluZyB8IFVpbnQ4QXJyYXksXG4gICAgb3B0aW9ucz86IHN0cmluZyB8IHtlbmNvZGluZz86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWR9IHwgbnVsbCB8IHVuZGVmaW5lZCxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG4gIG1rZGlyKHBhdGg6IHN0cmluZywgb3B0aW9ucz86IHtyZWN1cnNpdmU/OiBmYWxzZSB8IHVuZGVmaW5lZH0gfCB1bmRlZmluZWQpOiBQcm9taXNlPHZvaWQ+O1xuICBta2RpcihwYXRoOiBzdHJpbmcsIG9wdGlvbnM6IHtyZWN1cnNpdmU6IHRydWV9KTogUHJvbWlzZTxzdHJpbmc+O1xuICBta2RpcihwYXRoOiB1bmtub3duLCBvcHRpb25zPzogdW5rbm93bik6IFByb21pc2U8dm9pZD4gfCBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuICBybShcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IHtmb3JjZT86IGJvb2xlYW4gfCB1bmRlZmluZWQ7IHJlY3Vyc2l2ZT86IGJvb2xlYW4gfCB1bmRlZmluZWR9IHwgdW5kZWZpbmVkLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cblxuICByZW5hbWUob2xkUGF0aDogc3RyaW5nLCBuZXdQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aHJvdyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7XG4gIH1cbiAgd2F0Y2goXG4gICAgZmlsZW5hbWU6IHN0cmluZyxcbiAgICBvcHRpb25zPzogRlNXYXRjaE9wdGlvbnMgfCB1bmRlZmluZWQsXG4gICAgbGlzdGVuZXI/OiBGU1dhdGNoQ2FsbGJhY2sgfCB1bmRlZmluZWQsXG4gICk6IElGU1dhdGNoZXI7XG4gIHdhdGNoKGZpbGVuYW1lOiBzdHJpbmcsIGxpc3RlbmVyPzogRlNXYXRjaENhbGxiYWNrIHwgdW5kZWZpbmVkKTogSUZTV2F0Y2hlcjtcbiAgd2F0Y2goZmlsZW5hbWU6IHVua25vd24sIG9wdGlvbnM/OiB1bmtub3duLCBsaXN0ZW5lcj86IHVua25vd24pOiBJRlNXYXRjaGVyIHtcbiAgICB0aHJvdyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZha2VXZWJDb250YWluZXJQcm9jZXNzIGltcGxlbWVudHMgV2ViQ29udGFpbmVyUHJvY2VzcyB7XG4gIGV4aXQ6IFByb21pc2U8bnVtYmVyPiA9IFByb21pc2UucmVzb2x2ZSgwKTtcbiAgaW5wdXQ6IFdyaXRhYmxlU3RyZWFtPHN0cmluZz4gPSBuZXcgV3JpdGFibGVTdHJlYW08c3RyaW5nPigpO1xuICBvdXRwdXQ6IFJlYWRhYmxlU3RyZWFtPHN0cmluZz4gPSBuZXcgUmVhZGFibGVTdHJlYW08c3RyaW5nPigpO1xuXG4gIGtpbGwoKTogdm9pZCB7fVxuICByZXNpemUoZGltZW5zaW9uczoge2NvbHM6IG51bWJlcjsgcm93czogbnVtYmVyfSk6IHZvaWQge31cbn1cbiJdfQ==