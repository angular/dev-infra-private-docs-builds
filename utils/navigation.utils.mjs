/*!
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.dev/license
 */
import { inject } from '@angular/core';
import { DOCS_CONTENT_LOADER } from '../providers';
export const flatNavigationData = (tree) => {
    const result = [];
    const traverse = (node, level) => {
        node.level = level;
        if (node.path) {
            result.push(node);
        }
        if (node.children) {
            for (const child of node.children) {
                child.parent = node;
                traverse(child, level + 1);
            }
        }
    };
    for (const node of tree) {
        traverse(node, 1);
    }
    return result;
};
export const getNavigationItemsTree = (tree, mapFn) => {
    const traverse = (node) => {
        mapFn(node);
        if (node.children) {
            for (const child of node.children) {
                traverse(child);
            }
        }
    };
    for (const node of tree) {
        traverse(node);
    }
    return tree;
};
export const findNavigationItem = (items, predicate) => {
    let result = null;
    const traverse = (node) => {
        if (predicate(node)) {
            result = node;
        }
        if (node.children && !result) {
            for (const child of node.children) {
                traverse(child);
            }
        }
    };
    for (const node of items) {
        traverse(node);
    }
    return result;
};
export const isExternalLink = (link, windowOrigin) => new URL(link).origin !== windowOrigin;
export const markExternalLinks = (item, origin) => {
    if (item.path) {
        try {
            item.isExternal = isExternalLink(item.path, origin);
        }
        catch (err) { }
    }
};
export const mapNavigationItemsToRoutes = (navigationItems, additionalRouteProperties) => navigationItems
    .filter((route) => Boolean(route.path))
    .map((navigationItem) => {
    const route = {
        path: navigationItem.path,
        ...additionalRouteProperties,
    };
    route.data = {
        ...navigationItem,
        ...route.data,
    };
    route.resolve = {
        'docContent': (snapshot) => {
            return snapshot.data['contentPath'] !== undefined
                ? inject(DOCS_CONTENT_LOADER).getContent(snapshot.data['contentPath'])
                : undefined;
        },
        ...route.resolve,
    };
    return route;
});
export const normalizePath = (path) => {
    if (path[0] === '/') {
        return path.substring(1);
    }
    return path;
};
export const getBaseUrlAfterRedirects = (url, router) => {
    const route = router.parseUrl(url);
    route.fragment = null;
    route.queryParams = {};
    return normalizePath(route.toString());
};
export function handleHrefClickEventWithRouter(e, router) {
    const pointerEvent = e;
    if (pointerEvent.ctrlKey ||
        pointerEvent.shiftKey ||
        pointerEvent.altKey ||
        pointerEvent.metaKey) {
        return;
    }
    const closestAnchor = e.target.closest('a');
    if (closestAnchor?.target && closestAnchor.target !== 'self') {
        return;
    }
    const relativeUrl = closestAnchor?.getAttribute?.('href');
    if (relativeUrl) {
        e.preventDefault();
        router.navigateByUrl(relativeUrl);
    }
}
export function getActivatedRouteSnapshotFromRouter(router) {
    let route = router.routerState.root.snapshot;
    while (route.firstChild) {
        route = route.firstChild;
    }
    return route;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aWdhdGlvbi51dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2RvY3MvdXRpbHMvbmF2aWdhdGlvbi51dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFFSCxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBR3JDLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUVqRCxNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxDQUFDLElBQXNCLEVBQUUsRUFBRTtJQUMzRCxNQUFNLE1BQU0sR0FBcUIsRUFBRSxDQUFDO0lBRXBDLE1BQU0sUUFBUSxHQUFHLENBQUMsSUFBb0IsRUFBRSxLQUFhLEVBQUUsRUFBRTtRQUN2RCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQztRQUNELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2xCLEtBQUssTUFBTSxLQUFLLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUNsQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztnQkFDcEIsUUFBUSxDQUFDLEtBQUssRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDN0IsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDLENBQUM7SUFFRixLQUFLLE1BQU0sSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3hCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLHNCQUFzQixHQUFHLENBQ3BDLElBQXNCLEVBQ3RCLEtBQXFDLEVBQ3JD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VyxHQUFHLGFBQWEsRUFBRSxZQUFZLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMxRCxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNuQixNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7QUFDSCxDQUFDO0FBRUQsTUFBTSxVQUFVLG1DQUFtQyxDQUFDLE1BQWM7SUFDaEUsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBRTdDLE9BQU8sS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3hCLEtBQUssR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO0lBQzNCLENBQUM7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5kZXYvbGljZW5zZVxuICovXG5cbmltcG9ydCB7aW5qZWN0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgUm91dGUsIFJvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7TmF2aWdhdGlvbkl0ZW19IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHtET0NTX0NPTlRFTlRfTE9BREVSfSBmcm9tICcuLi9wcm92aWRlcnMnO1xuXG5leHBvcnQgY29uc3QgZmxhdE5hdmlnYXRpb25EYXRhID0gKHRyZWU6IE5hdmlnYXRpb25JdGVtW10pID0+IHtcbiAgY29uc3QgcmVzdWx0OiBOYXZpZ2F0aW9uSXRlbVtdID0gW107XG5cbiAgY29uc3QgdHJhdmVyc2UgPSAobm9kZTogTmF2aWdhdGlvbkl0ZW0sIGxldmVsOiBudW1iZXIpID0+IHtcbiAgICBub2RlLmxldmVsID0gbGV2ZWw7XG4gICAgaWYgKG5vZGUucGF0aCkge1xuICAgICAgcmVzdWx0LnB1c2gobm9kZSk7XG4gICAgfVxuICAgIGlmIChub2RlLmNoaWxkcmVuKSB7XG4gICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGUuY2hpbGRyZW4pIHtcbiAgICAgICAgY2hpbGQucGFyZW50ID0gbm9kZTtcbiAgICAgICAgdHJhdmVyc2UoY2hpbGQsIGxldmVsICsgMSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGZvciAoY29uc3Qgbm9kZSBvZiB0cmVlKSB7XG4gICAgdHJhdmVyc2Uobm9kZSwgMSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuZXhwb3J0IGNvbnN0IGdldE5hdmlnYXRpb25JdGVtc1RyZWUgPSAoXG4gIHRyZWU6IE5hdmlnYXRpb25JdGVtW10sXG4gIG1hcEZuOiAoaXRlbTogTmF2aWdhdGlvbkl0ZW0pID0+IHZvaWQsXG4pID0+IHtcbiAgY29uc3QgdHJhdmVyc2UgPSAobm9kZTogTmF2aWdhdGlvbkl0ZW0pID0+IHtcbiAgICBtYXBGbihub2RlKTtcbiAgICBpZiAobm9kZS5jaGlsZHJlbikge1xuICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBub2RlLmNoaWxkcmVuKSB7XG4gICAgICAgIHRyYXZlcnNlKGNoaWxkKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgZm9yIChjb25zdCBub2RlIG9mIHRyZWUpIHtcbiAgICB0cmF2ZXJzZShub2RlKTtcbiAgfVxuXG4gIHJldHVybiB0cmVlO1xufTtcblxuZXhwb3J0IGNvbnN0IGZpbmROYXZpZ2F0aW9uSXRlbSA9IChcbiAgaXRlbXM6IE5hdmlnYXRpb25JdGVtW10sXG4gIHByZWRpY2F0ZTogKGl0ZW06IE5hdmlnYXRpb25JdGVtKSA9PiBib29sZWFuLFxuKTogTmF2aWdhdGlvbkl0ZW0gfCBudWxsID0+IHtcbiAgbGV0IHJlc3VsdDogTmF2aWdhdGlvbkl0ZW0gfCBudWxsID0gbnVsbDtcblxuICBjb25zdCB0cmF2ZXJzZSA9IChub2RlOiBOYXZpZ2F0aW9uSXRlbSkgPT4ge1xuICAgIGlmIChwcmVkaWNhdGUobm9kZSkpIHtcbiAgICAgIHJlc3VsdCA9IG5vZGU7XG4gICAgfVxuICAgIGlmIChub2RlLmNoaWxkcmVuICYmICFyZXN1bHQpIHtcbiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5jaGlsZHJlbikge1xuICAgICAgICB0cmF2ZXJzZShjaGlsZCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGZvciAoY29uc3Qgbm9kZSBvZiBpdGVtcykge1xuICAgIHRyYXZlcnNlKG5vZGUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmV4cG9ydCBjb25zdCBpc0V4dGVybmFsTGluayA9IChsaW5rOiBzdHJpbmcsIHdpbmRvd09yaWdpbjogc3RyaW5nKSA9PlxuICBuZXcgVVJMKGxpbmspLm9yaWdpbiAhPT0gd2luZG93T3JpZ2luO1xuXG5leHBvcnQgY29uc3QgbWFya0V4dGVybmFsTGlua3MgPSAoaXRlbTogTmF2aWdhdGlvbkl0ZW0sIG9yaWdpbjogc3RyaW5nKTogdm9pZCA9PiB7XG4gIGlmIChpdGVtLnBhdGgpIHtcbiAgICB0cnkge1xuICAgICAgaXRlbS5pc0V4dGVybmFsID0gaXNFeHRlcm5hbExpbmsoaXRlbS5wYXRoLCBvcmlnaW4pO1xuICAgIH0gY2F0Y2ggKGVycikge31cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IG1hcE5hdmlnYXRpb25JdGVtc1RvUm91dGVzID0gKFxuICBuYXZpZ2F0aW9uSXRlbXM6IE5hdmlnYXRpb25JdGVtW10sXG4gIGFkZGl0aW9uYWxSb3V0ZVByb3BlcnRpZXM6IFBhcnRpYWw8Um91dGU+LFxuKTogUm91dGVbXSA9PlxuICBuYXZpZ2F0aW9uSXRlbXNcbiAgICAuZmlsdGVyKChyb3V0ZSk6IHJvdXRlIGlzIE5hdmlnYXRpb25JdGVtICYge3BhdGg6IHN0cmluZ30gPT4gQm9vbGVhbihyb3V0ZS5wYXRoKSlcbiAgICAubWFwKChuYXZpZ2F0aW9uSXRlbSkgPT4ge1xuICAgICAgY29uc3Qgcm91dGUgPSB7XG4gICAgICAgIHBhdGg6IG5hdmlnYXRpb25JdGVtLnBhdGgsXG4gICAgICAgIC4uLmFkZGl0aW9uYWxSb3V0ZVByb3BlcnRpZXMsXG4gICAgICB9O1xuXG4gICAgICByb3V0ZS5kYXRhID0ge1xuICAgICAgICAuLi5uYXZpZ2F0aW9uSXRlbSxcbiAgICAgICAgLi4ucm91dGUuZGF0YSxcbiAgICAgIH07XG5cbiAgICAgIHJvdXRlLnJlc29sdmUgPSB7XG4gICAgICAgICdkb2NDb250ZW50JzogKHNuYXBzaG90OiBBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHNuYXBzaG90LmRhdGFbJ2NvbnRlbnRQYXRoJ10gIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgPyBpbmplY3QoRE9DU19DT05URU5UX0xPQURFUikuZ2V0Q29udGVudChzbmFwc2hvdC5kYXRhWydjb250ZW50UGF0aCddKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG4gICAgICAgIC4uLnJvdXRlLnJlc29sdmUsXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHJvdXRlO1xuICAgIH0pO1xuXG5leHBvcnQgY29uc3Qgbm9ybWFsaXplUGF0aCA9IChwYXRoOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBpZiAocGF0aFswXSA9PT0gJy8nKSB7XG4gICAgcmV0dXJuIHBhdGguc3Vic3RyaW5nKDEpO1xuICB9XG4gIHJldHVybiBwYXRoO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEJhc2VVcmxBZnRlclJlZGlyZWN0cyA9ICh1cmw6IHN0cmluZywgcm91dGVyOiBSb3V0ZXIpOiBzdHJpbmcgPT4ge1xuICBjb25zdCByb3V0ZSA9IHJvdXRlci5wYXJzZVVybCh1cmwpO1xuICByb3V0ZS5mcmFnbWVudCA9IG51bGw7XG4gIHJvdXRlLnF1ZXJ5UGFyYW1zID0ge307XG4gIHJldHVybiBub3JtYWxpemVQYXRoKHJvdXRlLnRvU3RyaW5nKCkpO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUhyZWZDbGlja0V2ZW50V2l0aFJvdXRlcihlOiBFdmVudCwgcm91dGVyOiBSb3V0ZXIpIHtcbiAgY29uc3QgcG9pbnRlckV2ZW50ID0gZSBhcyBQb2ludGVyRXZlbnQ7XG4gIGlmIChcbiAgICBwb2ludGVyRXZlbnQuY3RybEtleSB8fFxuICAgIHBvaW50ZXJFdmVudC5zaGlmdEtleSB8fFxuICAgIHBvaW50ZXJFdmVudC5hbHRLZXkgfHxcbiAgICBwb2ludGVyRXZlbnQubWV0YUtleVxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBjbG9zZXN0QW5jaG9yID0gKGUudGFyZ2V0IGFzIEVsZW1lbnQpLmNsb3Nlc3QoJ2EnKTtcbiAgaWYgKGNsb3Nlc3RBbmNob3I/LnRhcmdldCAmJiBjbG9zZXN0QW5jaG9yLnRhcmdldCAhPT0gJ3NlbGYnKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgcmVsYXRpdmVVcmwgPSBjbG9zZXN0QW5jaG9yPy5nZXRBdHRyaWJ1dGU/LignaHJlZicpO1xuICBpZiAocmVsYXRpdmVVcmwpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgcm91dGVyLm5hdmlnYXRlQnlVcmwocmVsYXRpdmVVcmwpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90RnJvbVJvdXRlcihyb3V0ZXI6IFJvdXRlcik6IEFjdGl2YXRlZFJvdXRlU25hcHNob3Qge1xuICBsZXQgcm91dGUgPSByb3V0ZXIucm91dGVyU3RhdGUucm9vdC5zbmFwc2hvdDtcblxuICB3aGlsZSAocm91dGUuZmlyc3RDaGlsZCkge1xuICAgIHJvdXRlID0gcm91dGUuZmlyc3RDaGlsZDtcbiAgfVxuICByZXR1cm4gcm91dGU7XG59XG4iXX0=